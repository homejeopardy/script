<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Line Rehearsal Tool</title>
<style>
:root {
  --bg-color: #ffffff;
  --text-color: #000000;
  --highlight-color: #e0e0e0;
}
[data-theme="dark"] {
  --bg-color: #121212;
  --text-color: #ffffff;
  --highlight-color: #333333;
}
body {
  background-color: var(--bg-color);
  color: var(--text-color);
  font-family: sans-serif;
  text-align: center;
  margin: 0;
  padding: 20px;
}
.line-display {
  background: var(--highlight-color);
  padding: 20px;
  border-radius: 8px;
  margin: 20px 0;
  cursor: pointer;
}
button {
  padding: 10px 20px;
  margin: 10px;
  cursor: pointer;
}
</style>
</head>
<body>

<h1>Ultimate Line Rehearsal Tool</h1>

<input type="file" id="fileInput"><br>
<button onclick="resetRehearsal()">Reset Rehearsal</button>
<button onclick="toggleDarkMode()">Toggle Dark Mode</button>

<div class="line-display" onclick="showNextLine()">Click to Start</div>

<script>
let lines = [];
let userLines = [];
let currentIndex = 0;
let showingCue = true;
let characterName = "";

document.getElementById('fileInput').addEventListener('change', function(e) {
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = function(event) {
    processScript(event.target.result);
  };
  reader.readAsText(file);
});

function processScript(text) {
  const rawLines = text.split(/\r?\n/).map(line => line.trim()).filter(line => line !== "");
  lines = [];

  for (let i = 0; i < rawLines.length - 1; i++) {
    if (rawLines[i] === rawLines[i].toUpperCase()) {
      lines.push({ character: rawLines[i], line: rawLines[i + 1] });
    }
  }

  characterName = prompt("Enter your character name exactly as in the script:").toUpperCase();
  userLines = lines.filter((entry, index) => entry.character === characterName)
                   .map((entry, index, arr) => {
                     const cueIndex = lines.findIndex(l => l === entry);
                     return {
                       cue: cueIndex > 0 ? lines[cueIndex - 1].line : "(start)",
                       line: entry.line
                     };
                   });

  currentIndex = 0;
  showingCue = true;
  document.querySelector('.line-display').textContent = "Click to Start";
}

function showNextLine() {
  if (!userLines.length) return;

  if (showingCue) {
    document.querySelector('.line-display').textContent = userLines[currentIndex].cue;
    showingCue = false;
  } else {
    document.querySelector('.line-display').textContent = userLines[currentIndex].line;
    showingCue = true;
    currentIndex++;
    if (currentIndex >= userLines.length) {
      document.querySelector('.line-display').textContent = "ðŸŽ‰ Done!";
    }
  }
}

function resetRehearsal() {
  lines = [];
  userLines = [];
  currentIndex = 0;
  showingCue = true;
  characterName = "";
  document.getElementById('fileInput').value = "";
  document.querySelector('.line-display').textContent = "Click to Start";
}

function toggleDarkMode() {
  document.body.toggleAttribute('data-theme', 'dark');
}
</script>

</body>
</html>
