<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rehearsal Tool</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f5f5f5;
    }
    .container {
      text-align: center;
      max-width: 500px;
      margin: 20px;
      padding: 20px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .line-display {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 20px;
      min-height: 50px;
    }
    select {
      padding: 10px;
      margin: 10px 0;
      font-size: 16px;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      font-size: 16px;
      cursor: pointer;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 5px;
    }
    button:disabled {
      background-color: #cccccc;
    }
    .dark {
      background-color: #333;
      color: #fff;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>Ultimate Line Rehearsal Tool</h1>

    <div>
      <label for="characterSelect">Choose a character:</label>
      <select id="characterSelect"></select>
    </div>

    <div>
      <label for="voiceSelect">Choose a voice:</label>
      <select id="voiceSelect"></select>
    </div>

    <div class="line-display">Click to Start</div>

    <button onclick="startRehearsal()">Start Rehearsal</button>
    <button onclick="showNextLine()">Next Line</button>
    <button onclick="resetRehearsal()">Reset</button>
    <button onclick="toggleDarkMode()">Toggle Dark Mode</button>
    <button onclick="pauseSpeech()">Pause</button>
    <button onclick="resumeSpeech()">Resume</button>
    <button onclick="skipCue()">Skip Cue</button>
  </div>

  <script>
    const lines = [
      { character: "EURYDICE", line: "Iâ€™m dead." },
      { character: "CHILD", line: "Youâ€™re pretty." },
      { character: "EURYDICE", line: "Youâ€™re little." },
      { character: "CHILD", line: "I grow downward. Like a turnip." },
      { character: "EURYDICE", line: "What do you want?" },
      { character: "CHILD", line: "I wanted to see if you were comfortable." },
      { character: "EURYDICE", line: "Comfortable?" },
      { character: "CHILD", line: "Youâ€™re not itchy?" },
      { character: "EURYDICE", line: "No." },
      { character: "CHILD", line: "Thatâ€™s good." },
      { character: "cue", line: "Pointing at the suitcase" },
      { character: "CHILD", line: "What is that?" },
      { character: "EURYDICE", line: "The luggage for my stay. The porter brought it to my room for me." },
      { character: "THE STONES", line: "Rooms are not allowed!" },
      { character: "CHILD", line: "The porter?" },
      { character: "EURYDICE", line: "My father?" },
      { character: "CHILD", line: "Fathers are not allowed! Where is he?" },
      { character: "EURYDICE", line: "Heâ€™s at work." },
      { character: "CHILD", line: "Weâ€™ll have to dip you in the river again and make sure youâ€™re good and dunked." },
      { character: "THE STONES", line: "We will!" },
      { character: "cue", line: "Child exits the way he came, laughing." },
      { character: "THE STONES", line: "Good-bye!" },
      { character: "cue", line: "Orpheus sits alone at the gates of hell. He sings the same melody from the first scene. The Stones watch him, saddened. The Child enters." },
      { character: "CHILD", line: "Who are you?" },
      { character: "ORPHEUS", line: "I am Orpheus." },
      { character: "CHILD", line: "I am Lord of the Underworld." },
      { character: "ORPHEUS", line: "But youâ€™re so young!" },
      { character: "CHILD", line: "Donâ€™t be rude." },
      { character: "ORPHEUS", line: "Sorry. Did you like my music?" },
      { character: "CHILD", line: "No. I prefer happy music with a nice beat." },
      { character: "ORPHEUS", line: "Oh." },
      { character: "CHILD", line: "Youâ€™ve come for Eurydice." },
      { character: "ORPHEUS", line: "Yes!" },
      { character: "CHILD", line: "And you thought singing would get you through the gates of hell." },
      { character: "ORPHEUS", line: "What do I have to do?" },
      { character: "CHILD", line: "Youâ€™ll have to do more than sing." },
      { character: "ORPHEUS", line: "Iâ€™m not sure what you mean, sir." },
      { character: "CHILD", line: "Start walking home. Your wife just might be on the road behind you. We make it real nice here. So people want to stick around. As you walk, keep your eyes facing front. If you look back at her - poof! Sheâ€™s gone." },
      { character: "ORPHEUS", line: "I canâ€™t look at her?" },
      { character: "CHILD", line: "No." },
      { character: "ORPHEUS", line: "Why?" },
      { character: "CHILD", line: "Because." },
      { character: "ORPHEUS", line: "Because?" },
      { character: "CHILD", line: "Because. Do you understand me?" },
      { character: "ORPHEUS", line: "I look straight ahead. Thatâ€™s all?" },
      { character: "CHILD", line: "Yes." },
      { character: "ORPHEUS", line: "Thatâ€™s easy." },
      { character: "CHILD", line: "Good." },
      { character: "cue", line: "Orpheus hums as he begins to slowly walk down the aisle with intense focus. Eurydice and Father enter." },
      { character: "EURYDICE", line: "I hear him at the gates! Thatâ€™s his music! Heâ€™s come to save me!" },
      { character: "FATHER", line: "Do you want to go with him?" },
      { character: "EURYDICE", line: "Yes of course! Oh - youâ€™ll be lonely, wonâ€™t you?" },
      { character: "FATHER", line: "No, no." },
      { character: "EURYDICE", line: "Are you sure?" },
      { character: "FATHER", line: "Iâ€™ll take you to him." },
      { character: "cue", line: "He takes her arm and walk to the top of the path where Orpheus walks." },
      { character: "FATHER", line: "Is that him?" },
      { character: "EURYDICE", line: "Yes - I think so -" },
      { character: "FATHER", line: "Thereâ€™s one thing you need to know. If he turns around and sees you, youâ€™ll die a second death. Those are the rules. So step quickly. And donâ€™t cry out." },
      { character: "EURYDICE", line: "I wonâ€™t." },
      { character: "FATHER", line: "Good-bye." },
      { character: "cue", line: "They embrace." },
      { character: "EURYDICE", line: "Iâ€™ll look for a tree." },
      { character: "FATHER", line: "Iâ€™ll write you letters. Good-bye, Eurydice." },
      { character: "EURYDICE", line: "Good-bye." },
      { character: "cue", line: "She watches Father exit." },
      { character: "LOUD STONE", line: "Face forward!" },
      { character: "BIG STONE", line: "Keep walking." },
      { character: "EURYDICE", line: "Iâ€™m afraid!" },
      { character: "cue", line: "She turns to run back to her father." },
      { character: "THE STONES", line: "Turn around!" },
      { character: "LITTLE STONE", line: "Orpheus came all the way here to find you." },
      { character: "LOUD STONE", line: "He played the saddest music." },
      { character: "BIG STONE", line: "Even we -" },
      { character: "THE STONES", line: "The stones -" },
      { character: "LITTLE STONE", line: "Cried when we heard it." },
      { character: "cue", line: "Eurydice turns back to see Orpheus." },
      { character: "EURYDICE", line: "Thatâ€™s Orpheus?" },
      { character: "THE STONES", line: "Yes, thatâ€™s him!" },
      { character: "EURYDICE", line: "Whereâ€™s his music?" },
      { character: "THE STONES", line: "Itâ€™s in your head." },
      { character: "cue", line: "She begins to follow him. She goes faster, catching up to him and stops." },
      { character: "EURYDICE", line: "Orpheus?" },
      { character: "cue", line: "He stops and turns toward her, startled. The Stones gasp." },
      { character: "ORPHEUS", line: "You startled me." },
      { character: "EURYDICE", line: "Iâ€™m sorry." },
      { character: "ORPHEUS", line: "Why?" },
      { character: "EURYDICE", line: "I donâ€™t know." },
      { character: "cue", line: "She begins to back away from him." },
      { character: "ORPHEUS", line: "Eurydice. Weâ€™ve known each other for centuries. Remember when you wanted your name in a song so I put your name in a song - When I played my music at the gates of hell I was singing your name over and over and over again. Eurydice." },
      { character: "cue", line: "He quiets. He watches her go." }
    ];

    let userLines = [];
    let currentIndex = 0;
    let showingCue = true;
    let characterName = "";
    let selectedVoice = null;

    const characterSelect = document.getElementById('characterSelect');
    const voiceSelect = document.getElementById('voiceSelect');

    function populateCharacterList() {
      const characters = [...new Set(lines.map(line => line.character))];
      characters.forEach(char => {
        const option = document.createElement('option');
        option.value = char;
        option.textContent = char;
        characterSelect.appendChild(option);
      });
    }

    function populateVoiceList() {
      const voices = speechSynthesis.getVoices();
      voiceSelect.innerHTML = '';
      voices.forEach(voice => {
        const option = document.createElement('option');
        option.value = voice.name;
        option.textContent = `${voice.name} (${voice.lang})`;
        voiceSelect.appendChild(option);
      });
    }

    speechSynthesis.onvoiceschanged = populateVoiceList;

    function startRehearsal() {
      characterName = characterSelect.value;
      selectedVoice = speechSynthesis.getVoices().find(voice => voice.name === voiceSelect.value);

      userLines = lines
        .map((entry, index) => ({ ...entry, index }))
        .filter(entry => entry.character === characterName)
        .map(entry => {
          const cueIndex = entry.index > 0 ? entry.index - 1 : null;
          return {
            cue: cueIndex !== null ? lines[cueIndex].line : "(start)",
            line: entry.line
          };
        });

      currentIndex = 0;
      showingCue = true;
      document.querySelector('.line-display').textContent = "Click to Start";
    }

    function speak(text) {
      if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
      }
      const utterance = new SpeechSynthesisUtterance(text);
      if (selectedVoice) {
        utterance.voice = selectedVoice;
      }
      utterance.rate = 1.1;
      speechSynthesis.speak(utterance);
    }

    function showNextLine() {
      if (!userLines.length) {
        startRehearsal();
        return;
      }

      if (currentIndex >= userLines.length) {
        document.querySelector('.line-display').textContent = "ðŸŽ‰ Done!";
        return;
      }

      const display = document.querySelector('.line-display');

      if (showingCue) {
        display.textContent = userLines[currentIndex].cue;
        speak(userLines[currentIndex].cue);
        showingCue = false;
      } else {
        display.textContent = userLines[currentIndex].line;
        showingCue = true;
        currentIndex++;
      }
    }

    function resetRehearsal() {
      userLines = [];
      currentIndex = 0;
      showingCue = true;
      characterName = "";
      document.querySelector('.line-display').textContent = "Click to Start";
    }

    function toggleDarkMode() {
      document.body.classList.toggle('dark');
    }

    function pauseSpeech() {
      if (speechSynthesis.speaking && !speechSynthesis.paused) {
        speechSynthesis.pause();
      }
    }

    function resumeSpeech() {
      if (speechSynthesis.paused) {
        speechSynthesis.resume();
      }
    }

    function skipCue() {
      if (!userLines.length) return;

      if (!showingCue) {
        // Skip to next cue
        currentIndex++;
        if (currentIndex >= userLines.length) {
          document.querySelector('.line-display').textContent = "ðŸŽ‰ Done!";
          return;
        }
      }
      showNextLine();
    }

    // Initialize character list on page load
    window.onload = () => {
      populateCharacterList();
      populateVoiceList();
    };
  </script>

</body>
</html>
