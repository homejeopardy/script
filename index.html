<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Line Rehearsal Tool</title>
<style>
:root {
  --bg: #ffffff;
  --text: #000000;
  --highlight: #f0f0f0;
}
[data-theme="dark"] {
  --bg: #121212;
  --text: #ffffff;
  --highlight: #333333;
}
body {
  background: var(--bg);
  color: var(--text);
  font-family: sans-serif;
  margin: 0;
  padding: 20px;
  text-align: center;
}
button {
  margin: 10px;
  padding: 10px 20px;
}
#display {
  background: var(--highlight);
  margin: 20px auto;
  padding: 20px;
  max-width: 600px;
  border-radius: 8px;
  cursor: pointer;
  user-select: none;
}
</style>
</head>

<body>
<h1>Ultimate Line Rehearsal Tool</h1>

<input type="file" id="fileInput">
<br>
<input type="text" id="characterInput" placeholder="Your Character Name">
<br>
<button onclick="startRehearsal()">Start Rehearsal</button>
<button onclick="toggleDarkMode()">Toggle Dark Mode</button>
<button onclick="resetRehearsal()">Reset Rehearsal</button>

<div id="display" onclick="nextLine()" style="display:none;"></div>

<script>
let scriptLines = [];
let myLines = [];
let currentIndex = 0;
let showingCue = true;
let myCharacter = "";

function startRehearsal() {
  const file = document.getElementById('fileInput').files[0];
  myCharacter = document.getElementById('characterInput').value.trim().toUpperCase();
  if (!file || !myCharacter) {
    alert("Upload your script and enter your character name.");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    const raw = e.target.result.split(/\r?\n/);
    parseScript(raw);
    currentIndex = 0;
    showingCue = true;
    document.getElementById('display').style.display = 'block';
    showCue();
  };
  reader.readAsText(file);
}

function parseScript(lines) {
  scriptLines = [];
  for (let i = 0; i < lines.length - 1; i++) {
    if (lines[i].trim().toUpperCase() === myCharacter) {
      scriptLines.push({ cue: lines[i-1] || "(Start)", line: lines[i+1] || "" });
    }
  }
}

function showCue() {
  if (currentIndex >= scriptLines.length) {
    document.getElementById('display').innerText = "ðŸŽ‰ End of Script!";
    return;
  }
  document.getElementById('display').innerText = scriptLines[currentIndex].cue;
}

function showMyLine() {
  document.getElementById('display').innerText = scriptLines[currentIndex].line;
}

function nextLine() {
  if (currentIndex >= scriptLines.length) return;
  if (showingCue) {
    showMyLine();
    showingCue = false;
  } else {
    currentIndex++;
    showCue();
    showingCue = true;
  }
}

function toggleDarkMode() {
  document.documentElement.toggleAttribute('data-theme', 'dark');
}

function resetRehearsal() {
  currentIndex = 0;
  showingCue = true;
  showCue();
}
</script>

</body>
</html>
